## Telegram-бот для прогнозирования популярности размещения банкомата
>_Репозиторий содержит зафиксированную для сдачи ДЗ версию кода ml-сервиса для предсказания индекса популярности
банкомата, разрабатываемого в рамках годового проекта магистратуры МОВС-2023 (команда: Алина Лукманова, Антон Зайцев,
Сергей Вершинин). Основной репозиторий с кодом проекта доступен [здесь](https://github.com/SeVlVershinin/atm-project/) и 
содержит код данного бота в подкаталоге ```prediction-service```._ 

Сервис реализует функциональность для получения предсказания индекса популярности банкомата на основе данных о его 
местоположении и содержит следующие endpoint-ы: 
 - ```/predict-one``` - позволяет выполнить предсказание для одного банкомата;
 - ```/predict-many``` - позволяет выполнить предсказание сразу для нескольких банкоматов;
 - ```/predict-csv``` - позволяет загрузить csv-файл с данными нескольких банкоматов, а в ответ получить другой
csv-файл, в котором добавлены предсказанные индексы популярности;
 - ```/enrich-many``` - позволяет дополнить данные нескольких банкоматов данными сервисов dadata.ru, geotree.ru и 
OpenStreetMap, которые далее используются ML-моделью для прогнозирования;
 - ```/atm-groups``` - возвращает список банковских групп, участвующих в задаче;
 - ```/health``` - проверяет жизнеспособность сервиса (возвращает простой ответ в подтверждение);

Протестировать методы рабочего экземпляра сервиса можно [по этой ссылке](http://94.139.242.35/docs).

[Docker-образ с сервисом](https://hub.docker.com/repository/docker/sevlvershinin/atm-project-api) размещен на 
Docker Hub. Обратите внимание, что запуск образа может занимать несколько минут, в случае, если для сервиса 
включен режим обогащения данными (переменная среды ```DATA_ENRICHMENT_ENABLED``` установлена в TRUE) с использованием 
данных dadata.ru, geotree и OpenStreetMap. 

### Проверка работы сервиса
Для проверки работы методов сервиса можно использовать исходные данные в формате JSON из файла 
[atm_data_sample.json](manual-testing/atm_data_sample.json) или csv-файл 
[atm_data_sample.csv](manual-testing/atm_data_sample.csv).

### Состав файлов репозитория 
Исходный код сервиса расположен в данном репозитории и включает:
- [app/configs](app/configs) - настройки, которые влияют на работу сервиса и могут быть заданы с помощью 
переменных окружения;
- [app/data_collection](app/data_collection) - код обогащения исходных данных о банкомате данными сервисов dadata.ru, geotree.ru и 
Open street map;
- [app/predictor](app/predictor) - код класса, реализующего всю логику обработки исходных данных и получения предсказаний 
с помощью ML-модели, а также файлы модели и связанных компонент подготовки данных для модели;
- [app/main.py](app/main.py) - реализацию endpoint-ов сервиса;
- [app/dto_models.py](app/dto_models.py) - код pydantic-моделей;
- [Dockerfile](Dockerfile) - описание докер-образа с ml-сервисом
- [docker-compose.yml](docker-compose.yml) - docker compose файл, обеспечивающий одновременный запуск и связывание контейнера с сервисом и 
контейнера с Redis
- [.env-template](.env-template) - шаблон .env-файла, необходимого для запуска контейнеров  

### Контроль кода с помощью flake8
Для контроля качества кода использована библиотека flake8 со стандартными настройками (за исключением измененной на 119
длины строки - см.настройки в файле [.flake8](.flake8)) 




